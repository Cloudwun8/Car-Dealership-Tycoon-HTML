<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Car Tycoon Marketplace</title>
<style>
body { font-family: Arial; background:#eee; }
.container { width:96%; margin:auto; }
.car { background:#fff; border:1px solid #ccc; padding:10px; margin:8px; width:260px; display:inline-block; }
.button { padding:6px 10px; background:#007BFF; color:#fff; border:none; cursor:pointer; margin:2px; }
.button:hover { background:#0056b3; }
.money { font-size:18px; margin:10px 0; }
.rarity-Common { color:gray; }
.rarity-Rare { color:blue; }
.rarity-Epic { color:purple; }
.rarity-Legendary { color:gold; }
.track { color:red; font-weight:bold; }
.restore { color:brown; font-weight:bold; }
</style>
</head>
<body>

<div class="container">
<h1>ðŸš— Car Tycoon Marketplace</h1>
<div class="money">
ðŸ’° $<span id="money"></span> | ðŸ’³ Debt: $<span id="debt"></span>
</div>

<button class="button" onclick="takeLoan()">Take Loan</button>
<button class="button" onclick="saveGame()">Save Code</button>
<button class="button" onclick="loadGame()">Load Code</button>

<h2>Dealerships (Inventory Rotates)</h2>
<div class="tabs">
  <button class="button" onclick="showDealer('economy')">Economy</button>
  <button class="button" onclick="showDealer('used')">Used</button>
  <button class="button" onclick="showDealer('performance')">Performance</button>
  <button class="button" onclick="showDealer('luxury')">Luxury</button>
  <button class="button" onclick="showDealer('classic')">Classic</button>
  <button class="button" onclick="showDealer('track')">Track Only</button>
</div>

<div id="dealership"></div>

<h2>Your Cars</h2>
<div id="myCars"></div>

<h2>Public Auction</h2>
<div id="publicAuction"></div>

<h2>Your Auction</h2>
<div id="playerAuction"></div>

<h2>Events</h2>
<div id="events"></div>
</div>

<script>
let money = 140000;
let debt = 0;
let interestRate = 0.05;
let eventMultiplier = 1;
let currentDealer = "economy";

const rarities = { Common:1, Rare:1.3, Epic:1.7, Legendary:2.5 };

/* ---------- MASTER INVENTORY POOLS ---------- */

const dealerPools = {
economy: [
 {model:"Toyota Corolla", price:20000, rarity:"Common"},
 {model:"Honda Civic", price:22000, rarity:"Common"},
 {model:"Hyundai Elantra", price:21000, rarity:"Common"},
 {model:"Kia Forte", price:19500, rarity:"Common"}
],
used: [
 {model:"Ford Focus 2012", price:9000, rarity:"Common"},
 {model:"Toyota Camry 2009", price:8500, rarity:"Common"},
 {model:"BMW 328i 2008", price:12000, rarity:"Rare"},
 {model:"Audi A4 2007", price:11000, rarity:"Rare"}
],
performance: [
 {model:"Toyota Supra MK4", price:140000, rarity:"Epic"},
 {model:"Nissan Skyline R34", price:130000, rarity:"Epic"},
 {model:"Mazda RX-7 FD", price:95000, rarity:"Rare"},
 {model:"Chevrolet Corvette C7", price:90000, rarity:"Epic"}
],
luxury: [
 {model:"BMW M5", price:110000, rarity:"Rare"},
 {model:"Mercedes S-Class", price:125000, rarity:"Rare"},
 {model:"Audi RS7", price:115000, rarity:"Epic"}
],
classic: [
 {model:"1969 Ford Mustang", price:85000, rarity:"Epic", restore:true},
 {model:"1970 Dodge Charger", price:95000, rarity:"Epic", restore:true},
 {model:"Mercedes 300SL", price:400000, rarity:"Legendary", restore:true},
 {model:"Ferrari F40", price:1200000, rarity:"Legendary"}
],
track: [
 {model:"Ferrari FXX-K", price:2800000, rarity:"Legendary", track:true},
 {model:"McLaren P1 GTR", price:2400000, rarity:"Legendary", track:true},
 {model:"Porsche 911 GT3 Cup", price:450000, rarity:"Epic", track:true},
 {model:"Radical SR3", price:180000, rarity:"Rare", track:true}
]
};

/* ---------- ROTATING INVENTORY ---------- */

let dealerInventory = {};

function rotateInventory(){
  for(let d in dealerPools){
    dealerInventory[d] = [];
    const pool = [...dealerPools[d]].sort(()=>0.5-Math.random());
    dealerInventory[d] = pool.slice(0,3);
  }
  displayDealer();
}
rotateInventory();

/* ---------- UTIL ---------- */

function randomCondition(min=60){
  return Math.floor(Math.random()*(100-min))+min;
}

function updateUI(){
  document.getElementById("money").textContent = Math.floor(money);
  document.getElementById("debt").textContent = Math.floor(debt);
  displayDealer();
  displayMyCars();
}

/* ---------- DEALER DISPLAY ---------- */

function showDealer(name){
  currentDealer = name;
  displayDealer();
}

function displayDealer(){
  const d=document.getElementById("dealership");
  d.innerHTML="";
  dealerInventory[currentDealer].forEach(car=>{
    let condition = car.restore ? randomCondition(20) : randomCondition(currentDealer==="used"?40:70);
    const price = Math.floor(car.price * rarities[car.rarity] * eventMultiplier);
    d.innerHTML+=`
      <div class="car">
        <h3>${car.model}</h3>
        <p class="rarity-${car.rarity}">${car.rarity}</p>
        ${car.track?'<p class="track">TRACK ONLY</p>':''}
        ${car.restore?'<p class="restore">RESTORATION PROJECT</p>':''}
        <p>Condition: ${condition}%</p>
        <p>Price: $${price}</p>
        <button class="button" onclick='buyCar(${JSON.stringify(car)},${condition})'>Buy</button>
      </div>`;
  });
}

function buyCar(car,condition){
  const cost=Math.floor(car.price * rarities[car.rarity] * eventMultiplier);
  if(money>=cost){
    money-=cost;
    myCars.push({...car,condition,restored:!car.restore});
    updateUI();
  }
}

/* ---------- PLAYER CARS ---------- */

let myCars = [];

function displayMyCars(){
  const m=document.getElementById("myCars");
  m.innerHTML="";
  myCars.forEach((car,i)=>{
    const baseValue = car.price*(car.condition/100)*rarities[car.rarity];
    const value = car.restored ? baseValue*1.3 : baseValue;
    m.innerHTML+=`
      <div class="car">
        <h3>${car.model}</h3>
        <p class="rarity-${car.rarity}">${car.rarity}</p>
        ${car.track?'<p class="track">TRACK ONLY</p>':''}
        ${!car.restored?'<p class="restore">Needs Restoration</p>':''}
        <p>Condition: ${car.condition}%</p>
        <p>Value: $${Math.floor(value)}</p>
        <button class="button" onclick="repairCar(${i})">Repair</button>
        ${car.restored?`<button class="button" onclick="sellCar(${i})">Sell</button>
        <button class="button" onclick="startPlayerAuction(${i})">Auction</button>`:''}
      </div>`;
  });
}

function repairCar(i){
  const car=myCars[i];
  const cost=Math.floor((100-car.condition)* (car.restore?500:300));
  if(money>=cost){
    money-=cost;
    car.condition+=20;
    if(car.condition>=100){
      car.condition=100;
      car.restored=true;
    }
    updateUI();
  }
}

function sellCar(i){
  const car=myCars.splice(i,1)[0];
  money+=Math.floor(car.price*(car.condition/100)*rarities[car.rarity]);
  updateUI();
}

/* ---------- PLAYER AUCTION ---------- */

let playerAuction=null, auctionTimer=null;

function startPlayerAuction(index){
  playerAuction=myCars.splice(index,1)[0];
  let bid=Math.floor(playerAuction.price*(playerAuction.condition/100)*0.6);
  let time=10;

  clearInterval(auctionTimer);
  auctionTimer=setInterval(()=>{
    bid+=Math.floor(Math.random()*bid*0.1);
    time--;
    document.getElementById("playerAuction").innerHTML=`
      <div class="car">
        <h3>${playerAuction.model}</h3>
        <p>Current Bid: $${bid}</p>
        <p>Time Left: ${time}s</p>
      </div>`;
    if(time<=0){
      clearInterval(auctionTimer);
      money+=bid;
      updateUI();
    }
  },1000);
  updateUI();
}

/* ---------- PUBLIC AUCTION ---------- */

let publicAuction=null;

function spawnAuction(){
  const all=Object.values(dealerPools).flat();
  const base=all[Math.floor(Math.random()*all.length)];
  publicAuction={...base,condition:randomCondition(),bid:Math.floor(base.price*0.5)};
  document.getElementById("publicAuction").innerHTML=`
    <div class="car">
      <h3>${publicAuction.model}</h3>
      <p class="rarity-${publicAuction.rarity}">${publicAuction.rarity}</p>
      <p>Condition: ${publicAuction.condition}%</p>
      <p>Current Bid: $${publicAuction.bid}</p>
      <button class="button" onclick="bidPublicAuction()">Bid</button>
    </div>`;
}

function bidPublicAuction(){
  const inc=Math.floor(Math.random()*6000)+4000;
  if(money>=publicAuction.bid+inc){
    publicAuction.bid+=inc;
    if(Math.random()>0.6){
      money-=publicAuction.bid;
      myCars.push(publicAuction);
      publicAuction=null;
      updateUI();
    }
  }
}

/* ---------- LOANS ---------- */

function takeLoan(){
  const loan=50000;
  money+=loan;
  debt+=loan*(1+interestRate);
  updateUI();
}

/* ---------- EVENTS ---------- */

function randomEvent(){
  const r=Math.random();
  if(r<0.3){
    eventMultiplier=0.8;
    showEvent("ðŸ“‰ Market Crash!");
  }else if(r<0.6){
    eventMultiplier=1.25;
    showEvent("ðŸ“ˆ Market Boom!");
  }else{
    showEvent("ðŸ”§ Restoration Parts Discount!");
  }
  setTimeout(()=>eventMultiplier=1,15000);
}

function showEvent(msg){
  document.getElementById("events").innerHTML=`<p>${msg}</p>`;
}

/* ---------- SAVE / LOAD ---------- */

function saveGame(){
  const code=btoa(JSON.stringify({money,debt,myCars}));
  prompt("Copy save code:",code);
}

function loadGame(){
  const code=prompt("Paste save code:");
  if(code){
    const data=JSON.parse(atob(code));
    money=data.money;
    debt=data.debt;
    myCars=data.myCars;
    updateUI();
  }
}

/* ---------- TIMERS ---------- */

setInterval(rotateInventory,60000);
setInterval(spawnAuction,30000);
setInterval(randomEvent,45000);
setInterval(()=>{ if(debt>0) debt*=1.02; updateUI(); },20000);

updateUI();
spawnAuction();
</script>

</body>
</html>
